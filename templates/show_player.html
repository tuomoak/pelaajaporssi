{% extends "layout.html" %}

{% block title %}Pelaajapörssi - {{player.name}}{% endblock %}

{% block content %}

<h2>Pelaaja: {{player.name}}</h2>

{% for message in get_flashed_messages() %}
  <p  class="info">
    <b>{{ message }}</b>
  </p>
{% endfor %}

<p>
  Lisännyt: <a href="/user/{{ player.user_id }}"> {{ user.username }} </a>
</p>

{% if session.user_id == player.user_id %}

<p>
  <a href="/edit_player/{{ player.id }}"> Muokkaa </a> |
  <a href="/remove_player/{{ player.id }}"> Poista </a>
</p>

{% endif %}
<p>
{% if classes %}
  {% for class in classes %}
  {{ class.title}}: {{ class.value }}
  {% endfor %}
{% endif %}
</p>


{% for role_type in all_roles %}
  Mahdolliset {{ role_type }}:
    <ul>
    {% for role in roles %}
      {% if role['role_type'] == role_type %}
      <li> {{ role['role_name'] }}</li>
      {% endif %}
    
    {% endfor %}
    </ul>
  {% endfor %}

<p>Esittely:</p>

{{ player.profile}}

<form action="/suggest_idea" method="post">

<p><b>Ehdotus pelaajalle</b></p>

{% for contact in contacts %}
  
    {{ contact }}:
    <select name="contact" id="contact{{ contact }}">
      <option value="">(valitse)</option>
    {% for option in contacts[contact] %}
      <option value="{{ contact }}:{{ option }}">{{ option }}</option>
    {% endfor %}
    </select>
  
    {% endfor %}

{% for idea in ideas %}
  
    {{ idea }}:
    <select name="ideas" id="idea{{ idea }}">
      <option value="">(valitse)</option>
    {% for option in ideas[idea] %}
      <option value="{{ idea }}:{{ option }}">{{ option }}</option>
    {% endfor %}
    </select>
  
    {% endfor %}

  <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
  <input type="hidden" name="player_id" value="{{ player.id }}" />
  <input type="submit" value="Ehdota" />
 
 </form>

 <p></p>

 {% if player_ideas %}

{% for idea in player_ideas %}
  <li>Ehdotus käyttäjältä <a href="/user/{{ idea.user_id }}"> {{ idea.username }} </a> : {{ idea.contact_type}} => {{idea.value}}
  {% if idea.user_id == session.user_id %}
  <form action="/remove_idea/{{ idea.id }}" class="inline-form" method="post">
    <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
    <input type="hidden" name="player_id" value="{{ player.id }}" />
    <input type="submit" name="remove" value="Poista" />
  </li>
  {% endif %} 
  
  {% endfor %}
   {% else %}
   <li>Ei ehdotuksia</li>
  {% endif %}

{% endblock %}